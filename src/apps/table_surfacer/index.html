<html>
	<head>
	</head>
	<body>
		<div class="header">Table Surfacer</div>
		<div class="description">This application surfaces your CNC work table.</div>
		<div class="dro">
			<div class="dro-position">
			Tool Position: <span class="fabmo-posx"></span>,<span class="fabmo-posy"></span>,<span class="fabmo-posz"></span>
			</div>
			<div class="dro-status">
			Tool Status: <span class="fabmo-state"></span>
			</div>
		</div>
		
		<form>
			<p>Origin: X<input type="text" id="input-xorigin" value="0">  Y<input type="text" id="input-yorigin" value="0"></p>
			<p>Size: X<input type="text" id="input-xsize" value="24">  Y<input type="text" id="input-ysize" value="18"></p>
			<p>Cutter Diameter: <input type="text" id="input-cutter" value="0.25">(inches)</p>
			<p>Plunge: <input type="text" id="input-plunge" value="-0.125">(inches)</p>
			<p>Safe-Z: <input type="text" id="input-safez" value="1.0">(inches)</p>
			<p>Speed: <input type="text" id="input-speed" value="1.5">(inches)</p>
		</form>

		<button id="run-button">RESURFACE TABLE</button>
	</body>

	<script src="./js/jquery-1.10.2.js"></script>
	<script src="./js/string-format.js"></script>
	<script type="text/javascript">
		//var tool = new FabMo(location.hostname||'localhost', '9876');
		var tool = global.tool;
		setInterval(function() {
			tool.get_status(function(error, status) {
				$('.fabmo-posx').text(status.posx);
				$('.fabmo-posy').text(status.posy);
				$('.fabmo-posz').text(status.posz);
				$('.fabmo-state').text(status.state);
			});
		}, 100);

		var STEPOVER = 0.9;
		var template = "\
&XSTART = {xorigin}\n\
&YSTART = {yorigin}\n\
&XEND = &XSTART + {xsize}\n\
&YEND = &YSTART + {ysize}\n\
&ZDEPTH = {plunge}\n\
&ZCLEAR = {safez}\n\
&STEPOVER = {stepover}\n\
&SPEED = {speed}\n\
\
C6\n\
PAUSE 3\n\
\
&YP = &YSTART\n\
JZ,&ZCLEAR\n\
J2,&XSTART,&YSTART\n\
MS,&SPEED,&SPEED\n\
MZ,&ZDEPTH\n\
\
surface:\n\
MY,&YP\n\
MX,&XEND\n\
&YP=&YP+&STEPOVER\n\
MY,&YP\n\
IF &YP >= &YEND THEN GOTO done\n\
MX,&XSTART\n\
&YP=&YP+&STEPOVER\n\
IF &YP >= &YEND THEN GOTO done\n\
GOTO surface\n\
\
done:\n\
JZ,&ZCLEAR\n\
";

		$('#run-button').click(function(evt) {
			program = template.format({
				xsize : $('#input-xsize').val(),
				ysize : $('#input-ysize').val(),
				xorigin : $('#input-xorigin').val(),
				yorigin : $('#input-yorigin').val(),
				safez : $('#input-safez').val(),
				stepover : parseFloat($('#input-cutter').val())*STEPOVER,
				speed : $('#input-speed').val(),
				plunge : $('#input-plunge').val()
			});
			console.log(program)
			tool.sbp(program);
		});
	</script>
</html>